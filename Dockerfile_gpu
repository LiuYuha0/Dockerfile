# GPU docker.

FROM nvidia/cuda:12.5.1-devel-ubuntu20.04

LABEL maintainer="liuyuhao@hust.edu.cn"

# nvidia runtime
ENV NVIDIA_VISIBLE_DEVICES \
    ${NVIDIA_VISIBLE_DEVICES:-all}
ENV NVIDIA_DRIVER_CAPABILITIES \
    ${NVIDIA_DRIVER_CAPABILITIES:+$NVIDIA_DRIVER_CAPABILITIES,}graphics

ENV DEBIAN_FRONTEND=noninteractive

RUN apt update && apt install -y \
    apt-utils \
    cmake \
    build-essential \
    pkg-config \
    git \
    lsb-release \
    gnupg2 \
    curl

RUN sh -c 'echo "deb http://packages.ros.org/ros/ubuntu $(lsb_release -sc) main" > /etc/apt/sources.list.d/ros1-latest.list'

RUN curl -sSL 'http://packages.ros.org/ros.key' | apt-key add -

RUN apt-get update && apt-get install -y \
    ros-noetic-desktop-full \
    && rm -rf /var/lib/apt/lists/*

RUN cd /tmp && git clone https://github.com/google/glog.git && cd glog && git checkout v0.6.0 && \
    mkdir build && cd build && cmake -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=ON .. && make -j && make install && \
    cd /tmp && rm -rf glog
